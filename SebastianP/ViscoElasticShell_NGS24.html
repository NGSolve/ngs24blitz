
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>3. Viscoelastic Shell formulation using HHJ Method &#8212; NGSolve 24</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=3ee479438cf8b5e0d341" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=384b581d" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=87e54e7c" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=3ee479438cf8b5e0d341"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=efea14e4"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'SebastianP/ViscoElasticShell_NGS24';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="prev" title="1. Solve the non-linear Poisson equation for a graphene nano ribbon" href="../Siyar/graphene_nano_ribbon_toymodel.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/NGSlogo.png" class="logo__image only-light" alt="NGSolve 24 - Home"/>
    <script>document.write(`<img src="../_static/NGSlogo.png" class="logo__image only-dark" alt="NGSolve 24 - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    NGSolve 24
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../Siyar/graphene_nano_ribbon_toymodel.html">1. Solve the non-linear Poisson equation for a graphene nano ribbon</a></li>

<li class="toctree-l1 current active"><a class="current reference internal" href="#">3. Viscoelastic Shell formulation using HHJ Method</a></li>

</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/NGSolve/ngs24blitz" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/SebastianP/ViscoElasticShell_NGS24.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Viscoelastic Shell formulation using HHJ Method</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">3. Viscoelastic Shell formulation using HHJ Method</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#model-problem">4. Model Problem</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#geometrical-properties">4.1. Geometrical Properties:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#material-parameters">4.2. Material Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-geometry-by-using-occ">4.3. Build Geometry by using OCC</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mesh-the-above-geometry-using-refinehp">4.4. Mesh the above Geometry using RefineHP</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fe-spaces">4.5. FE Spaces</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#special-functions-and-useful-quantities">4.6. Special Functions and useful quantities</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-and-trial-functions">4.7. Test and Trial Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bilinearform">4.8. BilinearForm</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="viscoelastic-shell-formulation-using-hhj-method">
<h1><span class="section-number">3. </span>Viscoelastic Shell formulation using HHJ Method<a class="headerlink" href="#viscoelastic-shell-formulation-using-hhj-method" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ngsolve</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">ngsolve.webgui</span> <span class="kn">import</span> <span class="n">Draw</span>
<span class="kn">from</span> <span class="nn">netgen.occ</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">SetNumThreads</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="model-problem">
<h1><span class="section-number">4. </span>Model Problem<a class="headerlink" href="#model-problem" title="Link to this heading">#</a></h1>
<section id="geometrical-properties">
<h2><span class="section-number">4.1. </span>Geometrical Properties:<a class="headerlink" href="#geometrical-properties" title="Link to this heading">#</a></h2>
<div class="math notranslate nohighlight">
\[\begin{split}
\displaystyle
H = 50 \text{ mm} \\
L = 50 \text{ mm} \\
t_1 = 0.5 \text{ mm} \\
t_2 = 5 \text{ mm} \\
q_0 = 0.01 \text{ N mm}^{-2}
\end{split}\]</div>
<p><img alt="alt text" src="../_images/Picture1.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">H</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">t_1</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">t_2</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">Force</span> <span class="o">=</span> <span class="mf">1e-2</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="material-parameters">
<h2><span class="section-number">4.2. </span>Material Parameters<a class="headerlink" href="#material-parameters" title="Link to this heading">#</a></h2>
<p><img alt="alt text" src="../_images/Picture2.png" /></p>
<p>For the modeling of the viscoelastic behavior, we are using the generalized Maxwell Element as illustrated above. We assume an additive decomposition of the strains in terms of the Green strain tensor <span class="math notranslate nohighlight">\(\mathbf{E}\)</span>.</p>
<p>The material is assumed incompressible.
The viscoelastic model parameters are defined using a Prony Series with parameters <span class="math notranslate nohighlight">\(g_1\)</span> and <span class="math notranslate nohighlight">\(\tau_1\)</span> and the following relationships
$<span class="math notranslate nohighlight">\(
    E_1 = \frac{g_1}{1-g_1}  E_{\infty},\\
    \eta_1 = \tau_1 E_1.
\)</span>$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">E</span> <span class="o">=</span> <span class="mi">3</span>                           <span class="c1"># Young&#39;s Modulus</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">0.5</span>                        <span class="c1"># Poisson Ratio</span>
<span class="n">lam_material</span> <span class="o">=</span> <span class="n">E</span><span class="o">*</span><span class="n">nu</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">nu</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>   <span class="c1"># 1st Lame Constant with Plane Stress Consumptions</span>
<span class="n">mu_inf</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">nu</span><span class="p">)</span> <span class="o">*</span> <span class="n">E</span>       <span class="c1"># 2nd Lame Constant</span>

<span class="n">g1</span> <span class="o">=</span> <span class="mf">0.5</span>                        <span class="c1"># Prony Parameter</span>
<span class="n">tau1</span> <span class="o">=</span> <span class="mf">0.5</span>                      <span class="c1"># Prony Parameter</span>

<span class="n">E1</span> <span class="o">=</span> <span class="n">g1</span><span class="o">*</span><span class="n">E</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">g1</span><span class="p">)</span>                <span class="c1"># Young&#39;s Modulus Viscoelastic Part</span>
<span class="n">lam_1</span> <span class="o">=</span> <span class="n">E1</span><span class="o">*</span><span class="mf">0.5</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mf">0.5</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>       <span class="c1"># 1st Lame Constant with Plane Stress Consumptions Viscoelastic Part</span>
<span class="n">mu_1</span> <span class="o">=</span> <span class="n">g1</span><span class="o">*</span><span class="n">mu_inf</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">g1</span><span class="p">)</span>         <span class="c1"># 2nd Lame Constant Viscoelastic PArt</span>
<span class="n">eta1</span> <span class="o">=</span> <span class="n">tau1</span><span class="o">*</span><span class="n">E1</span>                  <span class="c1"># Dashpoint Element</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mat_horizontal</span> <span class="o">=</span> <span class="s2">&quot;mat_horizontal&quot;</span>
<span class="n">mat_vertical</span> <span class="o">=</span> <span class="s2">&quot;mat_vertical&quot;</span>
<span class="n">maxh</span> <span class="o">=</span> <span class="n">L</span><span class="o">/</span><span class="mi">5</span>
<span class="n">order</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="build-geometry-by-using-occ">
<h2><span class="section-number">4.3. </span>Build Geometry by using OCC<a class="headerlink" href="#build-geometry-by-using-occ" title="Link to this heading">#</a></h2>
<p>wire1 … horizontal part, wire2 … vertical part</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pnt1</span> <span class="o">=</span> <span class="n">Pnt</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">pnt2</span> <span class="o">=</span> <span class="n">Pnt</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">pnt3</span> <span class="o">=</span> <span class="n">Pnt</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="n">H</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
<span class="n">pnt4</span> <span class="o">=</span> <span class="n">Pnt</span><span class="p">(</span><span class="n">L</span><span class="p">,</span><span class="o">-</span><span class="n">H</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="n">wire1</span> <span class="o">=</span> <span class="n">Wire</span><span class="p">([</span><span class="n">Segment</span><span class="p">(</span><span class="n">pnt1</span><span class="p">,</span><span class="n">pnt2</span><span class="p">)</span>
             <span class="p">])</span>
<span class="n">wire2</span> <span class="o">=</span> <span class="n">Wire</span><span class="p">([</span><span class="n">Segment</span><span class="p">(</span><span class="n">pnt2</span><span class="p">,</span><span class="n">pnt3</span><span class="p">),</span>
             <span class="n">Segment</span><span class="p">(</span><span class="n">pnt4</span><span class="p">,</span><span class="n">pnt2</span><span class="p">)</span>
             <span class="p">])</span>

<span class="n">face1</span> <span class="o">=</span> <span class="n">wire1</span><span class="o">.</span><span class="n">Extrude</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">L</span><span class="p">))</span>
<span class="n">face2</span> <span class="o">=</span> <span class="n">wire2</span><span class="o">.</span><span class="n">Extrude</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">L</span><span class="p">))</span>

<span class="c1"># Name Edges for Boundary Conditions</span>
<span class="n">face1</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;clamped_left&quot;</span>
<span class="n">face2</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;free&quot;</span>
<span class="n">face2</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;clamped_bottom&quot;</span>

<span class="c1"># Mark Edges for refinement</span>
<span class="n">face1</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hpref</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">face2</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hpref</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">face2</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">hpref</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">face2</span><span class="o">.</span><span class="n">edges</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">hpref</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">face1</span><span class="o">.</span><span class="n">vertices</span><span class="p">)):</span>
    <span class="n">face1</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hpref</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">face2</span><span class="o">.</span><span class="n">vertices</span><span class="p">)):</span>
    <span class="n">face2</span><span class="o">.</span><span class="n">vertices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">hpref</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># Name Faces in order to assign thickness</span>
<span class="n">face1</span><span class="o">.</span><span class="n">faces</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">mat_horizontal</span>
<span class="n">face2</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">mat_vertical</span>
<span class="n">face2</span><span class="o">.</span><span class="n">faces</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">mat_vertical</span>

<span class="n">geometry1</span> <span class="o">=</span> <span class="n">Glue</span><span class="p">([</span><span class="n">face1</span><span class="p">])</span>
<span class="n">geometry2</span> <span class="o">=</span> <span class="n">Glue</span><span class="p">([</span><span class="n">face2</span><span class="p">])</span>
<span class="n">geometry</span> <span class="o">=</span> <span class="n">Glue</span><span class="p">([</span><span class="n">geometry1</span><span class="p">,</span><span class="n">geometry2</span><span class="p">])</span>
<span class="n">Draw</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;camera&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;transformations&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rotateY&quot;</span><span class="p">,</span> <span class="s2">&quot;angle&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">},{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rotateX&quot;</span><span class="p">,</span> <span class="s2">&quot;angle&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">}]}})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "3131e90fb2384dd0bb6f8dc9868f52b8"}</script><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BaseWebGuiScene
</pre></div>
</div>
</div>
</div>
</section>
<section id="mesh-the-above-geometry-using-refinehp">
<h2><span class="section-number">4.4. </span>Mesh the above Geometry using RefineHP<a class="headerlink" href="#mesh-the-above-geometry-using-refinehp" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">geo</span> <span class="o">=</span> <span class="n">OCCGeometry</span><span class="p">(</span><span class="n">geometry</span><span class="p">)</span>
<span class="n">ngmesh</span> <span class="o">=</span> <span class="n">geo</span><span class="o">.</span><span class="n">GenerateMesh</span><span class="p">(</span><span class="n">maxh</span><span class="o">=</span><span class="n">maxh</span><span class="p">)</span>
<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">ngmesh</span><span class="p">)</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">RefineHP</span><span class="p">(</span><span class="n">levels</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">factor</span><span class="o">=</span><span class="mf">0.75</span><span class="p">)</span>
<span class="n">mesh</span><span class="o">.</span><span class="n">Curve</span><span class="p">(</span><span class="n">order</span><span class="p">)</span>

<span class="n">thickness_fun</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">BoundaryCF</span><span class="p">({</span><span class="n">mat_horizontal</span><span class="p">:</span> <span class="n">t_1</span><span class="p">,</span> <span class="n">mat_vertical</span><span class="p">:</span> <span class="n">t_2</span><span class="p">})</span>              <span class="c1"># Assign Thickness to associated area</span>
<span class="n">Draw</span><span class="p">(</span><span class="n">thickness_fun</span><span class="p">,</span><span class="n">mesh</span><span class="p">,</span><span class="s1">&#39;thickness&#39;</span><span class="p">,</span> <span class="n">settings</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;camera&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;transformations&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rotateY&quot;</span><span class="p">,</span> <span class="s2">&quot;angle&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">},{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rotateX&quot;</span><span class="p">,</span> <span class="s2">&quot;angle&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">}]}})</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"version_major": 2, "version_minor": 0, "model_id": "5da67e54e9c3428687487fb3b8636b76"}</script><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>BaseWebGuiScene
</pre></div>
</div>
</div>
</div>
</section>
<section id="fe-spaces">
<h2><span class="section-number">4.5. </span>FE Spaces<a class="headerlink" href="#fe-spaces" title="Link to this heading">#</a></h2>
<p>Without going into the theory of the HHJ-shell method, we will refer to the various works by Schöberl, Neunteufel, Pechstein, et al.</p>
<p>For the analysis of the problem, we are using the following variables in the associated FE Space:</p>
<ul class="simple">
<li><p>displacement</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(u \in \mathrm{H}^1(\Omega)^3\)</span></p></li>
</ul>
</li>
<li><p>moment</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\mathbf{m} \in \mathbf{H}(\mathrm{div}\ \mathrm{div})\)</span></p></li>
</ul>
</li>
<li><p>hybridization vector</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\boldsymbol{hyb} \in \mathbf{H}(\mathrm{div})\)</span></p></li>
</ul>
</li>
<li><p>elastic membrane strain tensor</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\mathbf{\varepsilon} \in \mathbf{H}(\mathrm{curl} \ \mathrm{curl})\)</span></p></li>
</ul>
</li>
<li><p>viscoelastic membrane strain tensor</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\mathbf{\varepsilon}_v \in \mathbf{H}(\mathrm{curl} \ \mathrm{curl})\)</span></p></li>
</ul>
</li>
<li><p>elastic curvature tensor</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\mathbf{\kappa} \in \mathbf{H}(\mathrm{curl} \ \mathrm{curl})\)</span></p></li>
</ul>
</li>
<li><p>viscoelastic curvature tensor</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\mathbf{\kappa}_v \in \mathbf{H}(\mathrm{curl} \ \mathrm{curl})\)</span></p></li>
</ul>
</li>
<li><p>auxiliary variable (helps to reduce mebrane locking)</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(\mathbf{R} \in \mathbf{H}(\mathrm{curl} \ \mathrm{curl})\)</span></p></li>
</ul>
</li>
</ul>
<p>Green’s strain tensor is calculated by numerical integration over the thickness by
<span class="math notranslate nohighlight">\( \mathbf{E} = \mathbf{\varepsilon} + \zeta \mathbf{\kappa}\)</span> and <span class="math notranslate nohighlight">\( \mathbf{E}_v = \mathbf{\varepsilon}_v + \zeta \mathbf{\kappa}_v\)</span>.</p>
<p>Additionally, the boundary conditions are defined as dirichlet conditions in the displacements as well as dirichlet conditions in the hybridization space.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bbc_clamp</span> <span class="o">=</span> <span class="s2">&quot;clamped_left|clamped_bottom&quot;</span>
<span class="n">bbc_x</span> <span class="o">=</span> <span class="s2">&quot;clamped_left|clamped_bottom&quot;</span>
<span class="n">bbc_y</span> <span class="o">=</span> <span class="s2">&quot;clamped_left|clamped_bottom&quot;</span>
<span class="n">bbc_z</span> <span class="o">=</span> <span class="s2">&quot;clamped_left|clamped_bottom&quot;</span>

<span class="n">fes_mom</span> <span class="o">=</span> <span class="n">HDivDivSurface</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">discontinuous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">fes_u</span>   <span class="o">=</span> <span class="n">VectorH1</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">dirichletx_bbnd</span><span class="o">=</span><span class="n">bbc_x</span><span class="p">,</span> <span class="n">dirichlety_bbnd</span><span class="o">=</span><span class="n">bbc_y</span><span class="p">,</span> <span class="n">dirichletz_bbnd</span><span class="o">=</span><span class="n">bbc_z</span><span class="p">)</span>
<span class="n">fes_hyb</span> <span class="o">=</span> <span class="n">HDivSurface</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">orderinner</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dirichlet_bbnd</span><span class="o">=</span><span class="n">bbc_clamp</span><span class="p">)</span>

<span class="n">fes_curlcurl</span> <span class="o">=</span> <span class="n">HCurlCurl</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">,</span> <span class="n">discontinuous</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">fes</span>  <span class="o">=</span> <span class="n">fes_u</span><span class="o">*</span><span class="n">fes_hyb</span><span class="o">*</span><span class="n">fes_curlcurl</span><span class="o">*</span><span class="n">fes_curlcurl</span><span class="o">*</span><span class="n">fes_curlcurl</span><span class="o">*</span><span class="n">fes_mom</span><span class="o">*</span><span class="n">fes_curlcurl</span><span class="o">*</span><span class="n">fes_curlcurl</span>
<span class="n">solution</span> <span class="o">=</span> <span class="n">GridFunction</span><span class="p">(</span><span class="n">fes</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;solution&quot;</span><span class="p">)</span>           <span class="c1"># Solution Function</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">solution_old</span> <span class="o">=</span> <span class="n">GridFunction</span><span class="p">(</span><span class="n">fes</span><span class="p">)</span>                        <span class="c1"># Solution Function of previous time step</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Degrees of Freedom: &quot;</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">fes</span><span class="o">.</span><span class="n">FreeDofs</span><span class="p">(</span><span class="kc">True</span><span class="p">)))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Degrees of Freedom:  4989
</pre></div>
</div>
</div>
</div>
</section>
<section id="special-functions-and-useful-quantities">
<h2><span class="section-number">4.6. </span>Special Functions and useful quantities<a class="headerlink" href="#special-functions-and-useful-quantities" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Nsurf</span> <span class="o">=</span> <span class="n">specialcf</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>              <span class="c1"># Surface normal N</span>
<span class="n">t</span>     <span class="o">=</span> <span class="n">specialcf</span><span class="o">.</span><span class="n">tangential</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span>          <span class="c1"># Tangential Vector</span>
<span class="n">nel</span>   <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">Nsurf</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>                         <span class="c1"># In-plane edge normal</span>

<span class="n">A</span>  <span class="o">=</span> <span class="n">Id</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">dim</span><span class="p">)</span> <span class="o">-</span> <span class="n">OuterProduct</span><span class="p">(</span><span class="n">Nsurf</span><span class="p">,</span><span class="n">Nsurf</span><span class="p">)</span>   <span class="c1"># First metric tensor</span>

<span class="n">cfnphys</span> <span class="o">=</span> <span class="n">Normalize</span><span class="p">(</span><span class="n">Cof</span><span class="p">(</span><span class="n">A</span><span class="o">+</span><span class="n">Grad</span><span class="p">(</span><span class="n">u</span><span class="p">))</span><span class="o">*</span><span class="n">Nsurf</span><span class="p">)</span>

<span class="n">gradN</span> <span class="o">=</span> <span class="n">specialcf</span><span class="o">.</span><span class="n">Weingarten</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>                 <span class="c1"># Weingarten Tensor</span>

<span class="n">fesVF</span> <span class="o">=</span> <span class="n">VectorFacetSurface</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
<span class="n">averednv</span> <span class="o">=</span> <span class="n">GridFunction</span><span class="p">(</span><span class="n">fesVF</span><span class="p">)</span>                  <span class="c1"># averaged normal vector</span>
<span class="n">averednv_start</span> <span class="o">=</span> <span class="n">GridFunction</span><span class="p">(</span><span class="n">fesVF</span><span class="p">)</span>            <span class="c1"># averaged initial normal vector</span>

<span class="c1"># Computation of averaged Normal Vector</span>
<span class="n">n_</span> <span class="o">=</span> <span class="n">fesVF</span><span class="o">.</span><span class="n">TrialFunction</span><span class="p">()</span>
<span class="n">n_</span><span class="o">.</span><span class="n">Reshape</span><span class="p">((</span><span class="mi">3</span><span class="p">,))</span>

<span class="n">bfF</span> <span class="o">=</span> <span class="n">BilinearForm</span><span class="p">(</span><span class="n">fesVF</span><span class="p">,</span> <span class="n">symmetric</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">bfF</span> <span class="o">+=</span> <span class="n">Variation</span><span class="p">(</span> <span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="n">n_</span><span class="o">*</span><span class="n">n_</span> <span class="o">-</span> <span class="p">(</span><span class="n">cfnphys</span><span class="p">)</span><span class="o">*</span><span class="n">n_</span><span class="p">)</span><span class="o">*</span><span class="n">ds</span><span class="p">(</span><span class="n">element_boundary</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">ComputeAveredNV</span><span class="p">(</span><span class="n">averednv</span><span class="p">):</span>
    <span class="n">rf</span> <span class="o">=</span> <span class="n">averednv</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">CreateVector</span><span class="p">()</span>
    <span class="n">bfF</span><span class="o">.</span><span class="n">Apply</span><span class="p">(</span><span class="n">averednv</span><span class="o">.</span><span class="n">vec</span><span class="p">,</span> <span class="n">rf</span><span class="p">)</span>
    <span class="n">bfF</span><span class="o">.</span><span class="n">AssembleLinearization</span><span class="p">(</span><span class="n">averednv</span><span class="o">.</span><span class="n">vec</span><span class="p">)</span>
    <span class="n">invF</span> <span class="o">=</span> <span class="n">bfF</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">Inverse</span><span class="p">(</span><span class="n">fesVF</span><span class="o">.</span><span class="n">FreeDofs</span><span class="p">())</span>
    <span class="n">averednv</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">data</span> <span class="o">-=</span> <span class="n">invF</span><span class="o">*</span><span class="n">rf</span>

<span class="n">ComputeAveredNV</span><span class="p">(</span><span class="n">averednv</span><span class="p">)</span>
<span class="n">ComputeAveredNV</span><span class="p">(</span><span class="n">averednv_start</span><span class="p">)</span>

<span class="n">cfn</span>  <span class="o">=</span> <span class="n">Normalize</span><span class="p">(</span><span class="n">CoefficientFunction</span><span class="p">(</span> <span class="n">averednv</span><span class="o">.</span><span class="n">components</span> <span class="p">))</span>
<span class="n">cfnR</span> <span class="o">=</span> <span class="n">Normalize</span><span class="p">(</span><span class="n">CoefficientFunction</span><span class="p">(</span> <span class="n">averednv_start</span><span class="o">.</span><span class="n">components</span> <span class="p">))</span>  <span class="c1"># nR</span>

<span class="k">def</span> <span class="nf">SolveCondense</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">solver</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">condense</span><span class="p">:</span>
        <span class="n">res</span><span class="o">.</span><span class="n">data</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">harmonic_extension_trans</span> <span class="o">*</span> <span class="n">res</span>
        <span class="n">w</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">solver</span> <span class="o">*</span> <span class="n">res</span>
        <span class="n">w</span><span class="o">.</span><span class="n">data</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">harmonic_extension</span> <span class="o">*</span> <span class="n">w</span>
        <span class="n">w</span><span class="o">.</span><span class="n">data</span> <span class="o">+=</span> <span class="n">a</span><span class="o">.</span><span class="n">inner_solve</span> <span class="o">*</span> <span class="n">res</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">w</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">solver</span> <span class="o">*</span> <span class="n">res</span>

<span class="k">def</span> <span class="nf">SolveViscoTrapezoidalRule</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">X</span><span class="p">,</span><span class="n">X_0</span><span class="p">):</span>
    <span class="n">rel_err</span> <span class="o">=</span> <span class="mf">1e-8</span>  
    <span class="n">abs_err</span> <span class="o">=</span> <span class="mf">1e-8</span>  
    <span class="n">max_it</span> <span class="o">=</span> <span class="mi">25</span>
    
    <span class="n">freedofs</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">FreeDofs</span><span class="p">()</span>
    <span class="n">freedofsb</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">FreeDofs</span><span class="p">()</span>
    <span class="n">freedofs_c</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">space</span><span class="o">.</span><span class="n">FreeDofs</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">condense</span><span class="p">)</span>

    <span class="n">res</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">CreateVector</span><span class="p">()</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">X_0</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">CreateVector</span><span class="p">()</span>
    
    <span class="n">res0</span> <span class="o">=</span> <span class="n">X_0</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">CreateVector</span><span class="p">()</span>
    <span class="n">b</span><span class="o">.</span><span class="n">Apply</span><span class="p">(</span><span class="n">X_0</span><span class="o">.</span><span class="n">vec</span><span class="p">,</span><span class="n">res0</span><span class="p">)</span>
    <span class="n">res0</span><span class="p">[</span><span class="o">~</span><span class="n">freedofsb</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>

    <span class="n">a</span><span class="o">.</span><span class="n">Apply</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">vec</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
    <span class="n">res</span><span class="p">[</span><span class="o">~</span><span class="n">freedofs</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
    <span class="n">init_norm_res</span> <span class="o">=</span> <span class="n">Norm</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1"> Initial Residuum = </span><span class="si">{</span><span class="n">init_norm_res</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">max_it</span><span class="p">:</span>
        <span class="n">a</span><span class="o">.</span><span class="n">AssembleLinearization</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">vec</span><span class="p">)</span>
        <span class="n">inv</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">Inverse</span><span class="p">(</span><span class="n">freedofs_c</span><span class="p">)</span>
                    
        <span class="n">SolveCondense</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">inv</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>
        <span class="n">X</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">data</span> <span class="o">-=</span> <span class="n">w</span>          

        <span class="n">a</span><span class="o">.</span><span class="n">Apply</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">vec</span><span class="p">,</span> <span class="n">res</span><span class="p">)</span>
        <span class="n">res</span><span class="p">[</span><span class="o">~</span><span class="n">freedofs</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.</span>
        <span class="n">res</span><span class="o">.</span><span class="n">data</span> <span class="o">-=</span> <span class="n">res0</span>
        
        <span class="n">normres</span> <span class="o">=</span> <span class="n">Norm</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">normres</span> <span class="o">&lt;</span> <span class="n">rel_err</span> <span class="o">*</span> <span class="n">init_norm_res</span> <span class="ow">or</span> <span class="n">normres</span> <span class="o">&lt;</span> <span class="n">abs_err</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1"> Newton Step </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1">: Residuum = </span><span class="si">{</span><span class="n">normres</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">j</span><span class="p">,</span><span class="mi">0</span>
        
        <span class="n">j</span><span class="o">+=</span><span class="mi">1</span>

    <span class="k">return</span> <span class="n">j</span><span class="p">,</span><span class="n">Norm</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="test-and-trial-functions">
<h2><span class="section-number">4.7. </span>Test and Trial Functions<a class="headerlink" href="#test-and-trial-functions" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">u_</span><span class="p">,</span> <span class="n">hyb_</span><span class="p">,</span> <span class="n">eps_</span><span class="p">,</span> <span class="n">R_</span><span class="p">,</span> <span class="n">kappa_</span><span class="p">,</span> <span class="n">mom_</span><span class="p">,</span> <span class="n">eps_vi_</span><span class="p">,</span> <span class="n">kappa_vi_</span> <span class="o">=</span> <span class="n">fes</span><span class="o">.</span><span class="n">TrialFunction</span><span class="p">()[:</span><span class="mi">8</span><span class="p">]</span>
<span class="n">hyb_</span><span class="p">,</span> <span class="n">eps_</span><span class="p">,</span> <span class="n">R_</span><span class="p">,</span> <span class="n">kappa_</span><span class="p">,</span> <span class="n">mom_</span><span class="p">,</span> <span class="n">eps_vi_</span><span class="p">,</span> <span class="n">kappa_vi_</span> <span class="o">=</span> <span class="n">hyb_</span><span class="o">.</span><span class="n">Trace</span><span class="p">(),</span> <span class="n">eps_</span><span class="o">.</span><span class="n">Trace</span><span class="p">(),</span> <span class="n">R_</span><span class="o">.</span><span class="n">Operator</span><span class="p">(</span><span class="s2">&quot;dualbnd&quot;</span><span class="p">),</span> <span class="n">kappa_</span><span class="o">.</span><span class="n">Trace</span><span class="p">(),</span> <span class="n">mom_</span><span class="o">.</span><span class="n">Trace</span><span class="p">(),</span> <span class="n">eps_vi_</span><span class="o">.</span><span class="n">Trace</span><span class="p">(),</span> <span class="n">kappa_vi_</span><span class="o">.</span><span class="n">Trace</span><span class="p">()</span>

<span class="n">deps_vi</span><span class="p">,</span> <span class="n">dkappa_vi</span> <span class="o">=</span> <span class="n">fes</span><span class="o">.</span><span class="n">TestFunction</span><span class="p">()[</span><span class="mi">6</span><span class="p">:]</span>
<span class="n">deps_vi</span><span class="p">,</span> <span class="n">dkappa_vi</span> <span class="o">=</span> <span class="n">deps_vi</span><span class="o">.</span><span class="n">Trace</span><span class="p">(),</span> <span class="n">dkappa_vi</span><span class="o">.</span><span class="n">Trace</span><span class="p">()</span>

<span class="n">Fsurf_</span>    <span class="o">=</span> <span class="n">grad</span><span class="p">(</span><span class="n">u_</span><span class="p">)</span><span class="o">.</span><span class="n">Trace</span><span class="p">()</span> <span class="o">+</span> <span class="n">A</span>
<span class="n">Csurf_</span>    <span class="o">=</span> <span class="n">Fsurf_</span><span class="o">.</span><span class="n">trans</span><span class="o">*</span><span class="n">Fsurf_</span>
<span class="n">epssurf_</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Csurf_</span> <span class="o">-</span> <span class="n">A</span><span class="p">)</span>

<span class="n">nphys</span>   <span class="o">=</span> <span class="n">Normalize</span><span class="p">(</span><span class="n">Cof</span><span class="p">(</span><span class="n">Fsurf_</span><span class="p">)</span><span class="o">*</span><span class="n">Nsurf</span><span class="p">)</span>   <span class="c1"># normal of deformed surface</span>
<span class="n">tphys</span>   <span class="o">=</span> <span class="n">Normalize</span><span class="p">(</span><span class="n">Fsurf_</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
<span class="n">nelphys</span> <span class="o">=</span> <span class="n">Cross</span><span class="p">(</span><span class="n">nphys</span><span class="p">,</span><span class="n">tphys</span><span class="p">)</span>             <span class="c1"># in-plane edge normal of deformed surface</span>

<span class="n">Hn_</span> <span class="o">=</span> <span class="n">CoefficientFunction</span><span class="p">(</span> <span class="p">(</span><span class="n">u_</span><span class="o">.</span><span class="n">Operator</span><span class="p">(</span><span class="s2">&quot;hesseboundary&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">trans</span><span class="o">*</span><span class="n">nphys</span><span class="p">),</span> <span class="n">dims</span><span class="o">=</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="p">)</span>       <span class="c1"># Hessian of the displacement</span>
<span class="n">pnaverage</span> <span class="o">=</span> <span class="n">Normalize</span><span class="p">(</span> <span class="n">cfn</span> <span class="o">-</span> <span class="p">(</span><span class="n">tphys</span><span class="o">*</span><span class="n">cfn</span><span class="p">)</span><span class="o">*</span><span class="n">tphys</span> <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="bilinearform">
<h2><span class="section-number">4.8. </span>BilinearForm<a class="headerlink" href="#bilinearform" title="Link to this heading">#</a></h2>
<p>Recalling the variational formulation in the form
$<span class="math notranslate nohighlight">\(
	\delta\Psi+\frac{\partial\phi}{\partial\dot{\mathbf{E}_v}}\colon\delta\mathbf{E}_v+\delta W_{\text{ext}}=0,
\)</span><span class="math notranslate nohighlight">\(
and using the dissipation function as
\)</span><span class="math notranslate nohighlight">\(
	\phi = \frac{2}{3}\frac{1}{2}\eta_1{\left|\dot{\mathbf{E}_v}\right|}^2,
\)</span><span class="math notranslate nohighlight">\(
the second term can be rewritten as
\)</span><span class="math notranslate nohighlight">\(
	\frac{\partial\phi}{\partial\dot{\mathbf{E}_v}}\colon\delta\mathbf{E}_v=\frac{2}{3}\eta_1\dot{\mathbf{E}_v}\colon\delta\mathbf{E}_v.
\)</span><span class="math notranslate nohighlight">\(
Starting at \)</span>t_0<span class="math notranslate nohighlight">\(, where the solution is known, the next time step \)</span>t_0+\Delta t<span class="math notranslate nohighlight">\( can be determined by solving
\)</span><span class="math notranslate nohighlight">\(
	\int_{t_0}^{t_0+\Delta t} \left(\frac{2}{3}\eta_1\dot{\mathbf{E}_v}\colon\delta\mathbf{E}_v d\tau\right)=\int_{t_0}^{t_0+\Delta t} \left(-\delta\Psi-\delta W_{\text{ext}}\right)d\tau.
\)</span><span class="math notranslate nohighlight">\(
First of all, the result of the left hand side of the above equation is to be determined.
\)</span><span class="math notranslate nohighlight">\(
	\frac{2}{3}\eta_1 \int_{t_0}^{t_0+\Delta t} \left(\dot{\mathbf{E}_v}\colon\delta\mathbf{E}_v d\tau\right)=\frac{2}{3}\eta_1 \left({\mathbf{E}_v}\left(t_0+\Delta t\right)-{\mathbf{E}_v}\left(t_0\right)\right)\colon\delta\mathbf{E}_v
\)</span><span class="math notranslate nohighlight">\(
This result leads to
\)</span><span class="math notranslate nohighlight">\(
	\frac{2}{3}\eta_1 \left({\mathbf{E}_v}\left(t_0+\Delta t\right)-{\mathbf{E}_v}\left(t_0\right)\right)\colon\delta\mathbf{E}_v=\underbrace{\int_{t_0}^{t_0+\Delta t} \left(-\delta\Psi-\delta W_{\text{ext}}\right)d\tau}_{\text{Time Integration Method}},
\)</span>$
where the time integration method has to be chosen.</p>
<p>Using the trapezoidal rule, the right hand side from above gives
$<span class="math notranslate nohighlight">\(
	-\Delta t\left(\frac{1}{2}\left(\delta\Psi \big|_{t_0+\Delta t}+\delta\Psi \big|_{t_0}\right) + \frac{1}{2}\left(\delta W_{\text{ext}} \big|_{t_0+\Delta t}+ \delta W_{\text{ext}} \big|_{t_0}\right)\right).
\)</span><span class="math notranslate nohighlight">\(
For the fininte element analysis, the equation is used in the following form with two bilinear forms \)</span>a<span class="math notranslate nohighlight">\( and \)</span>b<span class="math notranslate nohighlight">\(
\)</span><span class="math notranslate nohighlight">\(
	\underbrace{\frac{2}{3}\eta_1 \left({\mathbf{E}_v}\left(t_0+\Delta t\right)-{\mathbf{E}_v}\left(t_0\right)\right)\colon\delta\mathbf{E}_v+\frac{\Delta t}{2}\left(\delta\Psi \big|_{t_0+\Delta t}+\delta W_{\text{ext}} \big|_{t_0+\Delta t}\right)}_{=:a} 
	= -\underbrace{\frac{\Delta t}{2}\left(\delta\Psi \big|_{t_0}+\delta W_{\text{ext}} \big|_{t_0}\right)}_{=:b}.
\)</span>$</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">par</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>      <span class="c1"># Load Parameter used for load stepping</span>
<span class="n">par0</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>     <span class="c1"># Previous Load Parameter</span>
<span class="n">DeltaT</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>   <span class="c1"># Time Step</span>

<span class="n">gausspoints</span>  <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">7</span><span class="o">+</span><span class="mi">2</span><span class="o">/</span><span class="mi">7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="mi">5</span><span class="p">)),</span> <span class="p">(</span><span class="mi">18</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span><span class="o">/</span><span class="mi">36</span> <span class="p">),</span> 
               <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">7</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="mi">7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="mi">5</span><span class="p">)),</span> <span class="p">(</span><span class="mi">18</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span><span class="o">/</span><span class="mi">36</span> <span class="p">),</span> 
               <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">7</span><span class="o">-</span><span class="mi">2</span><span class="o">/</span><span class="mi">7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="mi">5</span><span class="p">)),</span> <span class="p">(</span><span class="mi">18</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span><span class="o">/</span><span class="mi">36</span> <span class="p">),</span> 
               <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="o">/</span><span class="mi">7</span><span class="o">+</span><span class="mi">2</span><span class="o">/</span><span class="mi">7</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">6</span><span class="o">/</span><span class="mi">5</span><span class="p">)),</span> <span class="p">(</span><span class="mi">18</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">30</span><span class="p">))</span><span class="o">/</span><span class="mi">36</span> <span class="p">)</span>  <span class="p">]</span>     <span class="c1"># Used for numerical integration in thickness directions</span>

<span class="k">def</span> <span class="nf">BuildBF</span><span class="p">(</span><span class="n">rhs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="n">fac</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="n">rhs</span> <span class="k">else</span> <span class="mi">1</span>
    <span class="n">bf</span> <span class="o">=</span> <span class="n">BilinearForm</span><span class="p">(</span><span class="n">fes</span><span class="p">,</span> <span class="n">symmetric</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">condense</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">printelmat</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">for</span> <span class="p">(</span><span class="n">zi</span><span class="p">,</span> <span class="n">wi</span><span class="p">)</span> <span class="ow">in</span> <span class="n">gausspoints</span><span class="p">:</span>                <span class="c1"># thickness Integration</span>
        <span class="n">zeta</span> <span class="o">=</span> <span class="n">thickness_fun</span><span class="o">/</span><span class="mi">2</span><span class="o">*</span><span class="n">zi</span>
        <span class="n">weightdet</span> <span class="o">=</span> <span class="n">wi</span><span class="o">*</span><span class="n">thickness_fun</span><span class="o">/</span><span class="mi">2</span>

        <span class="n">E_</span>       <span class="o">=</span> <span class="n">eps_</span>   <span class="o">+</span> <span class="n">zeta</span><span class="o">*</span><span class="n">kappa_</span>
        <span class="n">E_vi_</span>    <span class="o">=</span> <span class="n">eps_vi_</span> <span class="o">+</span> <span class="n">zeta</span><span class="o">*</span><span class="n">kappa_vi_</span>
        <span class="n">delE_</span>    <span class="o">=</span> <span class="n">E_</span><span class="o">-</span><span class="n">E_vi_</span>

        <span class="n">FB</span> <span class="o">=</span>  <span class="n">A</span>
        <span class="n">III_Lambda</span> <span class="o">=</span> <span class="p">(</span><span class="n">Cof</span><span class="p">(</span><span class="n">FB</span><span class="p">)</span><span class="o">*</span><span class="n">Nsurf</span><span class="p">)</span><span class="o">*</span><span class="n">Nsurf</span>

        <span class="n">SVK</span> <span class="o">=</span> <span class="n">mu_inf</span><span class="o">*</span><span class="n">InnerProduct</span><span class="p">(</span><span class="n">E_</span><span class="p">,</span><span class="n">E_</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">lam_material</span><span class="o">*</span><span class="n">Trace</span><span class="p">(</span><span class="n">E_</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">SVK_VI</span> <span class="o">=</span> <span class="n">mu_1</span><span class="o">*</span><span class="n">InnerProduct</span><span class="p">(</span><span class="n">delE_</span><span class="p">,</span><span class="n">delE_</span><span class="p">)</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">lam_1</span><span class="o">*</span><span class="n">Trace</span><span class="p">(</span><span class="n">delE_</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
        
        <span class="n">bf</span> <span class="o">+=</span> <span class="n">Variation</span><span class="p">(</span><span class="n">fac</span><span class="o">*</span><span class="p">(</span><span class="n">SVK</span><span class="p">)</span><span class="o">*</span><span class="n">weightdet</span><span class="o">*</span><span class="n">III_Lambda</span><span class="o">*</span><span class="n">ds</span><span class="p">)</span><span class="o">.</span><span class="n">Compile</span><span class="p">()</span>
        <span class="n">bf</span> <span class="o">+=</span> <span class="n">Variation</span><span class="p">(</span><span class="n">fac</span><span class="o">*</span><span class="p">(</span><span class="n">SVK_VI</span><span class="p">)</span><span class="o">*</span><span class="n">weightdet</span><span class="o">*</span><span class="n">III_Lambda</span><span class="o">*</span><span class="n">ds</span><span class="p">)</span><span class="o">.</span><span class="n">Compile</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">rhs</span><span class="p">:</span>
            <span class="n">Eps_vi_last</span> <span class="o">=</span> <span class="n">solution_old</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
            <span class="n">kappa_vi_last</span> <span class="o">=</span> <span class="n">solution_old</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
            <span class="n">E_vi_last</span> <span class="o">=</span> <span class="n">Eps_vi_last</span><span class="o">+</span><span class="n">zeta</span><span class="o">*</span><span class="n">kappa_vi_last</span>

            <span class="n">Eps_vi_dot</span> <span class="o">=</span> <span class="p">(</span><span class="n">E_vi_</span><span class="o">-</span><span class="n">E_vi_last</span><span class="p">)</span>

            <span class="n">bf</span> <span class="o">+=</span> <span class="n">SymbolicBFI</span><span class="p">(</span><span class="mi">2</span><span class="o">/</span><span class="n">DeltaT</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="mi">3</span><span class="o">*</span><span class="n">eta1</span><span class="o">*</span><span class="p">(</span><span class="n">InnerProduct</span><span class="p">(</span><span class="n">Eps_vi_dot</span><span class="p">,</span><span class="n">deps_vi</span><span class="o">+</span><span class="n">zeta</span><span class="o">*</span><span class="n">dkappa_vi</span><span class="p">)</span><span class="o">+</span>
                                                <span class="n">InnerProduct</span><span class="p">(</span><span class="n">Eps_vi_dot</span><span class="p">,</span><span class="n">A</span><span class="p">)</span><span class="o">*</span>
                                                <span class="n">InnerProduct</span><span class="p">(</span><span class="n">deps_vi</span><span class="o">+</span><span class="n">zeta</span><span class="o">*</span><span class="n">dkappa_vi</span><span class="p">,</span><span class="n">A</span><span class="p">))</span><span class="o">*</span><span class="n">weightdet</span><span class="o">*</span><span class="n">III_Lambda</span><span class="p">,</span><span class="n">BND</span><span class="p">)</span> 

    <span class="n">bf</span> <span class="o">+=</span> <span class="n">Variation</span><span class="p">(</span> <span class="n">fac</span><span class="o">*</span><span class="p">(</span><span class="o">-</span><span class="n">InnerProduct</span><span class="p">(</span><span class="n">mom_</span><span class="p">,</span> <span class="n">kappa_</span> <span class="o">+</span> <span class="n">Hn_</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">nphys</span><span class="o">*</span><span class="n">Nsurf</span><span class="p">)</span><span class="o">*</span><span class="n">gradN</span><span class="p">))</span><span class="o">*</span><span class="n">ds</span> <span class="p">)</span><span class="o">.</span><span class="n">Compile</span><span class="p">()</span>

    <span class="n">bf</span> <span class="o">+=</span> <span class="n">Variation</span><span class="p">(</span> <span class="n">fac</span><span class="o">*</span><span class="n">InnerProduct</span><span class="p">(</span><span class="n">eps_</span><span class="o">-</span><span class="n">epssurf_</span><span class="p">,</span> <span class="n">R_</span><span class="p">)</span><span class="o">*</span><span class="n">ds</span><span class="p">(</span><span class="n">element_vb</span><span class="o">=</span><span class="n">BND</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">bf</span> <span class="o">+=</span> <span class="n">Variation</span><span class="p">(</span> <span class="n">fac</span><span class="o">*</span><span class="n">InnerProduct</span><span class="p">(</span><span class="n">eps_</span><span class="o">-</span><span class="n">epssurf_</span><span class="p">,</span> <span class="n">R_</span><span class="p">)</span><span class="o">*</span><span class="n">ds</span><span class="p">(</span><span class="n">element_vb</span><span class="o">=</span><span class="n">VOL</span> <span class="p">)</span> <span class="p">)</span>
    <span class="n">bf</span> <span class="o">+=</span> <span class="n">Variation</span><span class="p">(</span> <span class="n">fac</span><span class="o">*</span><span class="p">(</span><span class="n">acos</span><span class="p">(</span><span class="n">nel</span><span class="o">*</span><span class="n">cfnR</span><span class="p">)</span><span class="o">-</span><span class="n">acos</span><span class="p">(</span><span class="n">nelphys</span><span class="o">*</span><span class="n">pnaverage</span><span class="p">)</span><span class="o">-</span><span class="n">hyb_</span><span class="o">*</span><span class="n">nel</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">mom_</span><span class="o">*</span><span class="n">nel</span><span class="p">)</span><span class="o">*</span><span class="n">nel</span><span class="o">*</span><span class="n">ds</span><span class="p">(</span><span class="n">element_boundary</span><span class="o">=</span><span class="kc">True</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">Compile</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">rhs</span><span class="p">:</span>
        <span class="n">bf</span> <span class="o">+=</span> <span class="n">Variation</span><span class="p">(</span><span class="o">-</span><span class="n">fac</span><span class="o">*</span><span class="n">par0</span><span class="o">*</span><span class="n">Force</span><span class="o">*</span><span class="n">t_2</span><span class="o">*</span><span class="n">u_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ds</span><span class="p">(</span><span class="n">definedon</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">BBoundaries</span><span class="p">(</span><span class="s2">&quot;free&quot;</span><span class="p">)))</span><span class="o">.</span><span class="n">Compile</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">bf</span> <span class="o">+=</span> <span class="n">Variation</span><span class="p">(</span><span class="o">-</span><span class="n">fac</span><span class="o">*</span><span class="n">par</span><span class="o">*</span><span class="n">Force</span><span class="o">*</span><span class="n">t_2</span><span class="o">*</span><span class="n">u_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ds</span><span class="p">(</span><span class="n">definedon</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">BBoundaries</span><span class="p">(</span><span class="s2">&quot;free&quot;</span><span class="p">)))</span><span class="o">.</span><span class="n">Compile</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">bf</span>

<span class="n">bfa</span> <span class="o">=</span> <span class="n">BuildBF</span><span class="p">(</span><span class="n">rhs</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">bfb</span> <span class="o">=</span> <span class="n">BuildBF</span><span class="p">(</span><span class="n">rhs</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">solution</span><span class="o">.</span><span class="n">vec</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">t1</span> <span class="o">=</span> <span class="mi">5</span>                      <span class="c1"># Time period</span>
<span class="n">nsteps_load</span> <span class="o">=</span> <span class="mi">5</span>             <span class="c1"># number of load steps</span>
<span class="n">nsteps_relaxation</span> <span class="o">=</span> <span class="mi">25</span>      <span class="c1"># number of relaxation steps</span>

<span class="n">time_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">1e-5</span><span class="p">,</span><span class="n">nsteps_load</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">nsteps_relaxation</span><span class="p">))</span>
<span class="n">load_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">nsteps_load</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">nsteps_relaxation</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">disp_x</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">time_sol</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">disp_y</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">disp_x</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">time_sol</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">disp_y</span> <span class="o">+=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">solution</span><span class="o">.</span><span class="n">vec</span><span class="p">[:]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">time_vec</span><span class="p">))[</span><span class="mi">1</span><span class="p">:]:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">time_vec</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s1"> seconds, total time: </span><span class="si">{</span><span class="n">t1</span><span class="si">}</span><span class="s1"> seconds&#39;</span><span class="p">)</span>
    <span class="n">solution_old</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">vec</span>
    <span class="n">par</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">load_vec</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">par0</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">load_vec</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">DeltaT</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">time_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">time_vec</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

    <span class="k">with</span> <span class="n">TaskManager</span><span class="p">():</span>
        <span class="n">idx</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">SolveViscoTrapezoidalRule</span><span class="p">(</span><span class="n">bfa</span><span class="p">,</span><span class="n">bfb</span><span class="p">,</span><span class="n">solution</span><span class="p">,</span><span class="n">solution_old</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1"> Newton did not converge! Residuum = </span><span class="si">{</span><span class="n">res</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">break</span>

    <span class="n">rhs</span> <span class="o">=</span> <span class="n">solution</span><span class="o">.</span><span class="n">vec</span><span class="o">.</span><span class="n">CreateVector</span><span class="p">()</span>
    <span class="n">bfa</span><span class="o">.</span><span class="n">Apply</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">vec</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)</span>

    <span class="n">int0</span> <span class="o">=</span> <span class="n">Integrate</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">definedon</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">BBoundaries</span><span class="p">(</span><span class="s2">&quot;free&quot;</span><span class="p">))</span>
    <span class="n">u_sol</span> <span class="o">=</span> <span class="n">Integrate</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">definedon</span><span class="o">=</span><span class="n">mesh</span><span class="o">.</span><span class="n">BBoundaries</span><span class="p">(</span><span class="s2">&quot;free&quot;</span><span class="p">))</span>
    <span class="n">u_x</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">int0</span> <span class="o">*</span> <span class="n">u_sol</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">u_y</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">int0</span> <span class="o">*</span> <span class="n">u_sol</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">time_sol</span> <span class="o">+=</span> <span class="p">[</span><span class="n">time_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
    <span class="n">disp_x</span> <span class="o">+=</span> <span class="p">[</span><span class="n">u_x</span><span class="p">]</span>
    <span class="n">disp_y</span> <span class="o">+=</span> <span class="p">[</span><span class="n">u_y</span><span class="p">]</span>
    <span class="n">Redraw</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0 seconds, total time: 5 seconds
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Initial Residuum = 0.18283846562987913
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Newton Step 4: Residuum = 9.613622004225363e-11
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0 seconds, total time: 5 seconds
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Initial Residuum = 2.7308183506030095
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Newton Step 4: Residuum = 1.2100974050095214e-11
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0 seconds, total time: 5 seconds
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Initial Residuum = 5.394898164939767
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Newton Step 3: Residuum = 3.39935646824724e-08
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0 seconds, total time: 5 seconds
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Initial Residuum = 7.969443307950139
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Newton Step 3: Residuum = 2.3316472822128958e-08
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0 seconds, total time: 5 seconds
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Initial Residuum = 10.42767602400301
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Newton Step 3: Residuum = 1.6608197336892057e-08
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.208 seconds, total time: 5 seconds
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Initial Residuum = 12.752706669639814
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Newton Step 4: Residuum = 3.1688539557318255e-11
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.417 seconds, total time: 5 seconds
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Initial Residuum = 10.084436382162
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Newton Step 4: Residuum = 3.298624981935137e-11
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.625 seconds, total time: 5 seconds
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Initial Residuum = 7.955637591997203
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Newton Step 4: Residuum = 2.767537613672256e-11
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.833 seconds, total time: 5 seconds
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Initial Residuum = 6.266032890456912
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Newton Step 4: Residuum = 3.164675163369376e-11
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.042 seconds, total time: 5 seconds
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Initial Residuum = 4.929740574780688
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Newton Step 4: Residuum = 3.3889461186045196e-11
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.25 seconds, total time: 5 seconds
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Initial Residuum = 3.8754412355306025
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Newton Step 4: Residuum = 2.935955710016503e-11
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.458 seconds, total time: 5 seconds
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>	 Initial Residuum = 3.045025161455125
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">12</span><span class="p">],</span> <span class="n">line</span> <span class="mi">16</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="n">DeltaT</span><span class="o">.</span><span class="n">Set</span><span class="p">(</span><span class="n">time_vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">time_vec</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="k">with</span> <span class="n">TaskManager</span><span class="p">():</span>
<span class="ne">---&gt; </span><span class="mi">16</span>     <span class="n">idx</span><span class="p">,</span> <span class="n">res</span> <span class="o">=</span> <span class="n">SolveViscoTrapezoidalRule</span><span class="p">(</span><span class="n">bfa</span><span class="p">,</span><span class="n">bfb</span><span class="p">,</span><span class="n">solution</span><span class="p">,</span><span class="n">solution_old</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>     <span class="k">if</span> <span class="n">res</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>         <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\t</span><span class="s1"> Newton did not converge! Residuum = </span><span class="si">{</span><span class="n">res</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nn">Cell In[8], line 66,</span> in <span class="ni">SolveViscoTrapezoidalRule</span><span class="nt">(a, b, X, X_0)</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span>
<span class="g g-Whitespace">     </span><span class="mi">65</span> <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">max_it</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">66</span>     <span class="n">a</span><span class="o">.</span><span class="n">AssembleLinearization</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">vec</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">67</span>     <span class="n">inv</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">mat</span><span class="o">.</span><span class="n">Inverse</span><span class="p">(</span><span class="n">freedofs_c</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">69</span>     <span class="n">SolveCondense</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">inv</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Displacements of the free end&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_sol</span><span class="p">,</span> <span class="n">disp_x</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\bar</span><span class="si">{u}</span><span class="s1">_x$&#39;</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">time_sol</span><span class="p">,</span><span class="n">disp_y</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Displacement y&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\bar</span><span class="si">{u}</span><span class="s1">_y$&#39;</span><span class="p">,</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;dotted&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Norm(displacement):&#39;</span><span class="p">)</span>
<span class="n">Draw</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;displacement&quot;</span><span class="p">,</span> <span class="n">deformation</span><span class="o">=</span><span class="n">solution</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">settings</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;camera&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;transformations&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rotateY&quot;</span><span class="p">,</span> <span class="s2">&quot;angle&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">},{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rotateX&quot;</span><span class="p">,</span> <span class="s2">&quot;angle&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">}]}})</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Norm(eps_v):&#39;</span><span class="p">)</span>
<span class="n">Draw</span><span class="p">(</span><span class="n">Norm</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">6</span><span class="p">]),</span> <span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;viscoelastic strains&quot;</span><span class="p">,</span> <span class="n">deformation</span><span class="o">=</span><span class="n">solution</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">settings</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;camera&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;transformations&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rotateY&quot;</span><span class="p">,</span> <span class="s2">&quot;angle&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">},{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rotateX&quot;</span><span class="p">,</span> <span class="s2">&quot;angle&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">}]}})</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Norm(kappa_v):&#39;</span><span class="p">)</span>
<span class="n">Draw</span><span class="p">(</span><span class="n">Norm</span><span class="p">(</span><span class="n">solution</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">4</span><span class="p">]),</span> <span class="n">mesh</span><span class="p">,</span> <span class="s2">&quot;viscoelastic curvature&quot;</span><span class="p">,</span> <span class="n">deformation</span><span class="o">=</span><span class="n">solution</span><span class="o">.</span><span class="n">components</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">autoscale</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span><span class="n">settings</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;camera&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;transformations&quot;</span><span class="p">:</span> <span class="p">[{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rotateY&quot;</span><span class="p">,</span> <span class="s2">&quot;angle&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">},{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;rotateX&quot;</span><span class="p">,</span> <span class="s2">&quot;angle&quot;</span><span class="p">:</span> <span class="mi">25</span><span class="p">}]}})</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./SebastianP"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../Siyar/graphene_nano_ribbon_toymodel.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">1. </span>Solve the non-linear Poisson equation for a graphene nano ribbon</p>
      </div>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">3. Viscoelastic Shell formulation using HHJ Method</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#model-problem">4. Model Problem</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#geometrical-properties">4.1. Geometrical Properties:</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#material-parameters">4.2. Material Parameters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#build-geometry-by-using-occ">4.3. Build Geometry by using OCC</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mesh-the-above-geometry-using-refinehp">4.4. Mesh the above Geometry using RefineHP</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fe-spaces">4.5. FE Spaces</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#special-functions-and-useful-quantities">4.6. Special Functions and useful quantities</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#test-and-trial-functions">4.7. Test and Trial Functions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bilinearform">4.8. BilinearForm</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By NGSolve
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=3ee479438cf8b5e0d341"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=3ee479438cf8b5e0d341"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>